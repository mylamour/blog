---
layout: post
title:  当我们在谈安全默认时我们在谈什么
categories: 安全架构师
kerywords: 安全架构 安全合规 网络安全架构 网络安全 应用安全 应用安全架构 数据安全 数据安全架构 安全设计 安全默认
tags: 安全架构
---


安全默认（Security By Default）是一个老生常谈的话题。今天随便聊聊在安全架构设计中安全默认起到了什么作用。便于理解依旧会从网络、应用、数据几块去介绍。有时候涉及物理机房时可能还需要考虑敏感业务的机柜隔离，专线隔离，机柜单独上锁等，暂不在此赘述了（主要是不懂）。

# 1. 设计中的一些默认
 
安全默认可以简单看作一个从策略设计到工具实施过程（注意安全默认实际上对工具非常依赖）。在设计之初，会有各种针对网络、应用、数据的规划。这时候只是为了提供一个默认安全的愿景，而真正具备这个能力，是在其实施之后。以网络为例，假设已知的一些控制手段有DLP，PROXY，Firewall，WAF，IDS等等，那针对Zone如何设计分区，Zone间的访问涉及到的哪些安全控制，以及采用什么访问规则。一旦确定之后就形成了对网络层面基本的安全默认。**即解放了安全运营人员次次开防火墙配置规则，也解放了员工为每个业务提工单申请，同时也减轻了后续规则审计的成本**。下面逐个展开。

## 1.1 网络

对于网络来说，会主要关注因Zone的业务属性，由此去设计安全控制，其实也是贴近业务的一个过程。我们可以思考的点有： 在DMZ到HRZ之间会使用哪些安全控制？ 从Internet访问DMZ时呢？以及从DMZ访问Internet时又分别经过哪些安全控制等等，这些都是值的思考的。而且一旦在默认形成之后，所有的例外流程都应该采用工单记录，在遵循变更管理的情况下进行配置。但有时候也不得不承认，**即便是良好的设计，在一定程度的“例外”运营之下，也会变得面目全非**。

除此之外，我还简单列了一下可能在设计时关注的点，并使其达到安全默认的效果。
* 应用默认放在符合对应业务等级的Zone中
* 高等级的数据所在的Zone不能流向低等级的Zone
* 数据默认只能流向更高等级的Zone
* 不同DC之间同样的Zone不能默认无条件打通
* 数据从生产网流向办公网环境时仅允许到达XXX位置
* Zone A和Zone B默认之间不需要开通防火墙或者Zone X和Zone Y之间默认只允许XXX端口
* 所有传输协议默认使用具备TLS的版本，并不得使用XXX弱密码算法
* 内部传输默认采用PKI-Signed的证书
* 内外访问进行充分的隔离，同一个既有内外访问需求的服务需要设置不同的访问端点
* 所有对服务器的访问只能通过堡垒机所在的Zone

## 1.2 应用

对于应用来说，我会更多的关注在SDLC上，其实是比较容易理解的。通过在SDLC中覆盖安全能力，实现对应用生命周期的安全默认。无论是架构评审的准入机制（应用必须经过CICD可能不一定是安全来拍板），以及发版的基本要求，在一定程度上都是实现了安全默认。

* 新的组件引入必须进行评估，不得使用哪些不符合要求的组件
* 采购的系统本地部署时需要替换统一内部组件
* 默认为所有客户端，web前端集成对应的安全SDK
* CICD必须经过SCA，SAST，IAST，Docker Image Scan，（往左还可以在本地Dev时进行扫描，往右拿到APK/APP包进行扫描）
* 哪些业务的应用的漏洞必须在多长的时间内进行及时的更新，什么情况下是不允许上线的
* 哪些业务的应用必须代码审计以及渗透测试
* 应用的敏感配置文件必须放在Vault里
* 应用在bootstrap时需要校验完整性
* 应用之间通过证书及mTLS进行认证
* 应用不允许直接暴露NodePort，仅允许通过LB或API Gateway暴露
* 凡是走CICD暴露的web服务，自动覆盖网络层面的安全能力。（WAF，Anti-DDOS）等等

## 1.3 数据

对于数据而言，属于灯下黑的状态。看似在设计上非常的关注对数据的保护，但在安全默认上实际一直都是一个被忽略的点。我们很多情况下都会关注到应用的代码扫描和网络的传输加密。但往往会忽略不同等级数据的流动。例如针对等级为X及以上的数据不能离开所在的Zone，且等级为X及以上的数据仅允许在xx情况下访问。

* 针对等级为X以上的数据不得进行存储
* 针对等级为X以上的数据不得进行分享
* 针对哪些等级的数据禁止本地存储（PC、U盘、移动介质等）
* 针对等级为X以上的数据默认进行加密，且必须使用在HSM内的密钥
* 针对等级为X及以上的仅在严格授权下才能访问
* 证书生成密钥生成需要在什么环境下
* 证书分发密钥分发需要在什么工具里等等
* 哪些等级的系统日志一定要有


# 2. 总结

不难发现在谈及应用和数据两块的安全默认时，一直在说”等级为X“的数据，“哪些类型的业务”诸如此类，需要注意的是不同与网络这种基础设施层面。应用和数据的安全默认需要充分的综合业务场景，并且针对不同的重要程度提供不同的安全能力。在这里列举的一些设计规则也只是抛砖引玉，**在实际做设计的时候一定要谨记贴近业务，服务于业务（不是服务于同事）**。还需要将其配置在对应的Firewall，HIDS，SAST等工具中。这些条条框框的实现形成了所谓的安全默认。 同时也不难发现安全默认是为了使安全能力更加无感，降低对业务的侵入性并通过用空间换时间的方式来减少对业务的阻碍（提前铺好防御，以便业务更快迭代），相反安全左移则是通过时间换空间的方式让安全部门有更及早的参与进去（提前参与，以便更多反应空间）。

另外针对SAAS服务，一些安全默认看起来好像只能由SAAS厂商来控制，那这个时候，所谓的安全默认能做哪些事情，不妨思考一下。例如在网络与访问上是不是要求对方支持NACL，有没有流量清洗的能力，是否可以IDP集成等等、其次在应用与权限上，数据与加密层面，也可以思考一下企业还能做些什么能达到安全默认的效果。