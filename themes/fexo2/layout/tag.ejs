<div class="content content-tag">
  <%- partial('_partial/component/page-header', {location: __('location.tags')}) %>
    <%- partial('_partial/component/tag-box') %>
      <%- getPostListsDom(site.tags.sort('name'))%>
</div>

<%- partial('_partial/component/back-top', {showBacktop: theme.backtop.tag}) %>

  <% function getPostListsDom(tags) { var postList=[]; var processedTagNames=new Set(); tags.each(function(tag, i) { var
    tagNamesArray=tag.name.split(" ");  
  
      tagNamesArray.forEach(function(tagName) {  
        if (!processedTagNames.has(tagName)) {  
          processedTagNames.add(tagName);  
  
          var relatedTags = site.tags.filter(function(tag) {  
            return tag.name.split(" ").includes(tagName);  
          });  
  
          var tagLength = relatedTags.reduce(function(totalLength, tag) {  
            return totalLength + tag.length;  
          }, 0);  
  
          var tagInfo = {id: i % 5, isTag: true, tagName: tagName, count: tagLength};  
          postList.push(tagInfo);  
  
          relatedTags.forEach(function(tag) {  
            tag.posts.sort('date', -1).each(function(post) {  
              postList.push(post);  
            });  
          });  
        }  
      });  
    });  
  
    var dom = '<ul class=" list-post">';

    postList.forEach(function (post, i) {
    var patialPath = post.isTag ? '_partial/component/item-tag' : '_partial/component/item-post';
    dom += partial(patialPath, {post: post});
    });

    dom += '</ul>';
    return dom;
    }%>